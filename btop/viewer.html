<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>btop</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            background: #000; 
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #terminal {
            width: 100%;
            height: 100%;
        }
        .xterm-viewport::-webkit-scrollbar { display: none; }
        .xterm-viewport { scrollbar-width: none; }
        .xterm-cursor-layer { display: none !important; }
    </style>
</head>
<body>
    <div id="terminal"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script>
        const term = new Terminal({
            cols: 120,
            rows: 40,
            cursorBlink: false,
            cursorStyle: 'bar',
            cursorInactiveStyle: 'none',
            disableStdin: true,
            convertEol: true,
            scrollback: 0,
            fontFamily: '"JetBrains Mono", "Fira Code", "SF Mono", Menlo, Monaco, "Courier New", monospace',
            fontSize: 14,
            lineHeight: 1.0,
            letterSpacing: 0,
            allowTransparency: true,
            theme: {
                background: '#000000',
                foreground: '#c9a0f0',
                cursor: 'transparent',
                cursorAccent: 'transparent'
            }
        });
        
        term.open(document.getElementById('terminal'));
        
        const eventSource = new EventSource('/stream');
        
        eventSource.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                // Strip trailing newline to prevent scroll
                const content = data.ansi.replace(/\n$/, '');
                term.write('\x1b[H\x1b[J' + content);
            } catch (e) {
                console.error('Parse error:', e);
            }
        };
        
        eventSource.onerror = () => {
            term.write('\x1b[H\x1b[31mConnection lost, reconnecting...\x1b[0m');
        };
    </script>
</body>
</html>
